@page "/CriarPerguntasProva"

@inject ProvaService Prova

@if (mostrarAlert)
{
    <MudAlert Severity="Severity.Error"
              ContentAlignment="HorizontalAlignment.Center"
              ShowCloseIcon="true" CloseIconClicked="(() => CloseMe(false))">
        @Erros
    </MudAlert>
}
else @if (string.IsNullOrEmpty(Prova.ProvaInstancia.NomeProfessor))
{
    <MudText Typo="Typo.h3"
             Class="d-flex align-center justify-center"
             Color="Color.Warning">
        Não existe uma prova!!!
    </MudText>

    <MudButton ButtonType="ButtonType.Button"
               Variant="Variant.Filled"
               Color="Color.Error"
               Size="Size.Small"
               Href="/CriarProva"
               Class="d-flex align-center"
               Style="margin-top: 15px;">
        Clique Aqui para Criar uma Prova
    </MudButton>
}
else
{
   
<MudPaper Height="100%" Width="100%">
    <MudContainer MaxWidth="MaxWidth.Large">

        <div class="mb-5">
            <MudText Class="mt-5 mud-spacing-md pd-4">
                    <b>Digite o Enunciado da {@NumeroQuestao} Questão </b>
            </MudText>
            <MudForm @ref="@form" @bind-IsValid="@success" @bind-Errors="@errors"
               Style="margin-bottom: 50px;">
                <MudTextField @bind-Value="UmaPergunta.EnunciadoDaPergunta"
                              Lines="2"
                              T="string"
                              Required="true"
                              RequiredError="Campo Obrigatorio"
                              Label="Enunciado da Questão"
                              Variant="Variant.Text" />
            </MudForm>
        </div>

        <div class="mb-3 mt-5">
            <MudForm @ref="@form" @bind-IsValid="@success" @bind-Errors="@errors">
                <MudGrid>
                    <MudItem xs="12" Class="mud-elevation-4 mud-spacing">
                        <MudTextField @bind-Value="AlternativaModel1!.TextoDasAlternativa"
                                      Required="true"
                                      RequiredError="Campo Obrigatório"
                                      Lines="3"
                                      Label="Alternativa 1"
                                      InputType="InputType.Text"
                                      Variant="Variant.Text" />

                        <MudRadioGroup @bind-Value="AlternativaModel1.IsCorreta">
                            <MudRadio Value="true"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Correta?
                            </MudRadio>
                        </MudRadioGroup>
       
                     </MudItem>
                       <MudItem xs="3">
                            <div class="mt-1 mb-4">
                                <MudButton OnClick="(() => AdicionarAlternativa(AlternativaModel1!))"
                                           Variant="Variant.Filled"
                                           Color="Color.Success"
                                           Disabled="@disableQuestoes">
                                Adicionar Alternataiva 1
                                </MudButton>
                            </div>
                    </MudItem>
                </MudGrid>
            </MudForm>
        </div>


        <div class="mb-3">
            <MudForm @ref="@form" @bind-IsValid="@success" @bind-Errors="@errors">
                <MudGrid>
                    <MudItem xs="12" Class="mud-elevation-4 mud-spacing">
                        <MudTextField @bind-Value="AlternativaModel2!.TextoDasAlternativa"
                                      Required="true"
                                      RequiredError="Campo Obrigatório"
                                      Lines="3"
                                      Variant="Variant.Text"
                                      Label="Alternativa 2"
                                      InputType="InputType.Text"
                                      />
                        <MudRadioGroup @bind-Value="AlternativaModel2.IsCorreta">
                            <MudRadio Value="true"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Correta?
                            </MudRadio>
                            <MudRadio Value="false"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Errada?
                            </MudRadio>
                        </MudRadioGroup>
                    </MudItem>          
                       <MudItem xs="3">
                        <div class="mt-5 mb-4">
                            <MudButton OnClick="(() => AdicionarAlternativa(AlternativaModel2))"
                                       Variant="Variant.Filled"
                                       Color="Color.Success"
                                       Disabled="@disableQuestoes">
                                Adicionar Alternataiva 2
                            </MudButton>
                        </div>
                    </MudItem>
                </MudGrid>
            </MudForm>
        </div>

        <div class="mb-3">
            <MudForm @ref="@form" @bind-IsValid="@success" @bind-Errors="@errors">
                <MudGrid>
                    <MudItem xs="12" Class="mud-elevation-4 mud-spacing">
                        <MudPaper>
                            <MudTextField @bind-Value="AlternativaModel3!.TextoDasAlternativa"
                                          Required="true"
                                          RequiredError="Campo Obrigatório"
                                          Lines="3"
                                          Label="Alternativa 3"
                                          Variant="Variant.Text"
                                          InputType="InputType.Text" />
                        </MudPaper>
                        <MudRadioGroup @bind-Value="AlternativaModel3.IsCorreta">
                            <MudRadio Value="true"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Correta?
                            </MudRadio>
                            <MudRadio Value="false"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Errada?
                            </MudRadio>
                        </MudRadioGroup>
                    </MudItem>
                         <MudItem xs="3">
                                <div class="mt-5 mb-4">
                                    <MudButton OnClick="(() => AdicionarAlternativa(AlternativaModel3))"
                                               Variant="Variant.Filled"
                                               Color="Color.Success"
                                               Disabled="@disableQuestoes">
                                Adicionar Alternataiva 3
                                    </MudButton>
                                </div>
                        </MudItem>
                </MudGrid>
            </MudForm>
        </div>

        <div class="mb-3">
            <MudForm @ref="@form" @bind-IsValid="@success" @bind-Errors="@errors">

                <MudGrid>
                    <MudItem xs="12" Class="mud-elevation-4 mud-spacing">
                        <MudPaper>
                            <MudTextField @bind-Value="AlternativaModel4!.TextoDasAlternativa"
                                          Required="true"
                                          RequiredError="Campo Obrigatório"
                                          Lines="3"
                                          Label="Alternativa 4"
                                          Variant="Variant.Text"
                                          InputType="InputType.Text" />
                        </MudPaper>
                        <MudRadioGroup @bind-Value="AlternativaModel4.IsCorreta">
                            <MudRadio Value="true"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Correta?
                            </MudRadio>
                        </MudRadioGroup>
                        <MudRadioGroup @bind-Value="AlternativaModel4.IsCorreta">
                            <MudRadio Value="false"
                                      Color="Color.Secondary"
                                      Size="Size.Large">
                                Alternativa Errada?
                            </MudRadio>
                        </MudRadioGroup>
                    </MudItem>
                          <MudItem xs="12">
                                <div class="mt-5 mb-4">
                                    <MudButton OnClick="(() => AdicionarAlternativa(AlternativaModel4))"
                                               Variant="Variant.Filled"
                                               Color="Color.Success"
                                               Disabled="@disableQuestoes">
                                        Adicionar Alternataiva 4
                                    </MudButton>
                                </div>
                        </MudItem>
                </MudGrid>
            </MudForm>
        </div>

        <div class="mt-5 d-flex align-center justify-center">
            <MudButton OnClick="(()=> AddQuestao())"
                       ButtonType="ButtonType.Submit"
                       Variant="Variant.Filled"
                       Color="Color.Success"
                       Disabled="@BotaoAddQuestaoDisable">
                Adicionar Questão
            </MudButton>
        </div>


    </MudContainer>
</MudPaper>


}
    




@code {
    bool success;
    string[] errors = { };

    MudForm form = new MudForm();

    bool IsCorretaAlternativa;

    bool BotaoAddQuestaoDisable = true;

    bool disableQuestoes = false;


    [Inject]
    public NavigationManager? NavigationManager { get; set; }

    [Parameter]
    public int? NumeroQuestao { get; set; }


    public Questao UmaQuestao { get; set; } = new();

    public List<Questao> ListaQuestoes { get; set; } = new List<Questao>();

    public Alternativa? AlternativaModel1 { get; set; } = new()
    {
        OpcaoAlternativa = EOpcaoAlternativa.A
    };

    public Alternativa AlternativaModel2 { get; set; } = new()
        {
            OpcaoAlternativa = EOpcaoAlternativa.B
        };

    public Alternativa AlternativaModel3 { get; set; } = new()
        {
            OpcaoAlternativa = EOpcaoAlternativa.C
        };

    public Alternativa AlternativaModel4 { get; set; } = new()
        {
            OpcaoAlternativa = EOpcaoAlternativa.D
        };

    public List<Alternativa> ListaAlternativas { get; set; } = new();


    public List<Pergunta> ListaPerguntas { get; set; } = new();

    public Pergunta UmaPergunta { get; set; } = new();

    public string? Erros { get; set; } = string.Empty;
    public string? Success { get; set; } = string.Empty;

    private bool mostrarAlert = false;
    private bool fecharAlert = false;

    private void AdicionarAlternativa(Alternativa alternativa)
    {

        if (!string.IsNullOrWhiteSpace(alternativa.TextoDasAlternativa))
        {
            AddAlternativaNaPergunta(alternativa);
        }
        else
        {
            Erros = $"Campo inválido, erro ao adicionar Pergunta {alternativa.TextoDasAlternativa}";
            ShowAlerts();
        }
    }


    private void AddAlternativaNaPergunta(Alternativa alternativaModel)
    {
        ListaAlternativas.Add(alternativaModel);

        if(ListaAlternativas.Count == 4)
        {             
            disableQuestoes = true;
            BotaoAddQuestaoDisable = false;
        }
    }

    private void AddQuestao()
    {
        if (ListaAlternativas.Count() > 0)
        {
            UmaQuestao.ListaAlternativas.AddRange(ListaAlternativas);

            ListaQuestoes.Add(UmaQuestao);

            UmaPergunta.Questoes.AddRange(ListaQuestoes);

            ListaPerguntas.Add(UmaPergunta);

            Prova.ProvaInstancia.Perguntas.AddRange(ListaPerguntas);

            disableQuestoes = true;       

        }
        else
        {
            Erros = "Erro ao adicionar Questão!";
            ShowAlerts();
        }


    }

    private void CloseMe(bool value)
    {
        if (value)
        {
            fecharAlert = false;
        }
        else
        {
            mostrarAlert = false;
        }
    }
    private void ShowAlerts()
    {
        mostrarAlert = true;
        fecharAlert = true;
    }

}
